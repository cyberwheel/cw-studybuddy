<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Study Buddy â€” Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0b1220;
  --card:#0f172a;
  --border:#1f2937;
  --text:#e2e8f0;
  --muted:#94a3b8;
  --brand:#4f46e5;
  --brand2:#22d3ee;
  --ok:#10b981;
  --err:#ef4444;
}

*{box-sizing:border-box;transition:all .25s ease;}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:'Inter',system-ui;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  overflow-x:hidden;
}

/* HEADER */
header{
  background:rgba(15,23,42,.9);
  backdrop-filter:blur(8px);
  border-bottom:1px solid var(--border);
  padding:16px 22px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:sticky;
  top:0;
  z-index:10;
  animation:slideDown .6s ease;
}
.logo{font-weight:800;font-size:1.1rem;}
.logout{
  color:#fca5a5;
  text-decoration:none;
  font-weight:500;
  border:1px solid #991b1b;
  padding:6px 10px;
  border-radius:8px;
}
.logout:hover{background:#991b1b22;transform:translateY(-1px);}

/* TABS */
main{flex:1;padding:24px;display:flex;flex-direction:column;align-items:center;}
.tabs{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-bottom:20px;}
.tab-btn{
  background:#1e293b;
  border:1px solid #2a374d;
  border-radius:8px;
  color:var(--text);
  padding:10px 16px;
  cursor:pointer;
  font-weight:500;
  position:relative;
}
.tab-btn.active{
  background:linear-gradient(90deg,var(--brand),var(--brand2));
  color:#fff;
  box-shadow:0 2px 8px rgba(79,70,229,.3);
  transform:translateY(-2px);
}

/* PANELS */
.panel{
  display:none;
  width:100%;
  max-width:720px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:24px;
  animation:fadeSlide .45s ease;
}
.panel.active{display:block;}

h2{
  font-size:1.15rem;
  margin:0 0 12px;
  color:var(--brand2);
}

/* INPUTS & BUTTONS */
input[type=file],input[type=text],textarea{
  width:100%;
  background:#0b1220;
  border:1px solid var(--border);
  border-radius:10px;
  padding:12px;
  color:var(--text);
  font-size:.95rem;
  margin-bottom:10px;
  outline:none;
}
input:focus,textarea:focus{
  border-color:var(--brand2);
  box-shadow:0 0 10px rgba(34,211,238,0.3);
}

button{
  background:linear-gradient(90deg,var(--brand),var(--brand2));
  color:#fff;
  border:none;
  border-radius:10px;
  padding:10px 18px;
  font-weight:600;
  cursor:pointer;
  box-shadow:0 2px 8px rgba(34,211,238,.2);
}
button:hover{opacity:.9;transform:translateY(-1px);}
button:active{transform:translateY(1px) scale(0.98);}

/* PANEL MESSAGE */
.msg{
  margin-top:12px;
  font-size:.9rem;
  color:var(--ok);
  opacity:.9;
}

/* CHART + TABLE */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:16px;
  color:var(--muted);
  border-radius:10px;
  overflow:hidden;
}
th,td{
  border:1px solid var(--border);
  padding:8px 10px;
  font-size:.9rem;
}
th{background:#1e293b;color:var(--text);}
canvas{opacity:0;animation:fadeIn .8s ease forwards;}

/* BANNER */
.banner{
  position:fixed;
  top:70px;
  left:50%;
  transform:translateX(-50%);
  background:#0b1b3a;
  border:1px solid #20335a;
  color:#dbeafe;
  padding:10px 16px;
  border-radius:10px;
  z-index:15;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
  animation:fadeInOut 5s ease forwards;
}

/* ANIMATIONS */
@keyframes fadeSlide{
  from{opacity:0;transform:translateY(10px);}
  to{opacity:1;transform:translateY(0);}
}
@keyframes fadeIn{
  from{opacity:0;}
  to{opacity:1;}
}
@keyframes fadeInOut{
  0%{opacity:0;transform:translate(-50%,10px);}
  10%,90%{opacity:1;transform:translate(-50%,0);}
  100%{opacity:0;transform:translate(-50%,-10px);}
}
@keyframes slideDown{
  from{opacity:0;transform:translateY(-10px);}
  to{opacity:1;transform:translateY(0);}
}

/* RESPONSIVE */
@media(max-width:768px){
  main{padding:16px;}
  .panel{padding:16px;}
  h2{font-size:1rem;}
  input,textarea{font-size:.9rem;}
}
</style>
</head>
<body>
<header>
  <div class="logo">Study Buddy â€” Admin Console</div>
  <a href="/logout" class="logout">Logout</a>
</header>

<main>
  <div class="tabs">
    <button class="tab-btn active" data-tab="upload">ðŸ“‚ Upload Notes</button>
    <button class="tab-btn" data-tab="qa">ðŸ’¡ Add Q&A</button>
    <button class="tab-btn" data-tab="analytics">ðŸ“Š Analytics</button>
  </div>

  <!-- Upload -->
  <section id="upload" class="panel active">
    <h2>ðŸ“˜ Upload Study Materials</h2>
    <form method="POST" action="/admin-upload" enctype="multipart/form-data">
      <input type="file" name="files" multiple required>
      <button type="submit">Upload & Reindex</button>
    </form>
    {% if message %}<div class="msg">{{ message }}</div>{% endif %}
  </section>

  <!-- Q&A -->
  <section id="qa" class="panel">
    <h2>ðŸ’¡ Add Verified Q&A</h2>
    <form method="POST" action="/admin-qa">
      <input type="text" name="question" placeholder="Enter question..." required>
      <textarea name="answer" rows="6" placeholder="Enter verified answer..." required></textarea>
      <button type="submit">Add to Knowledge Base</button>
    </form>
  </section>

  <!-- Analytics -->
  <section id="analytics" class="panel">
    <h2>ðŸ“Š Usage Analytics</h2>
    <p style="color:var(--muted);font-size:.9rem;">Visual overview of query trends and engagement.</p>
    <canvas id="chart" height="280"></canvas>
    <table id="userTable">
      <thead><tr><th>Top Users</th><th>Queries</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const tabs=document.querySelectorAll('.tab-btn');
const panels=document.querySelectorAll('.panel');
tabs.forEach(btn=>{
  btn.addEventListener('click',()=>{
    tabs.forEach(b=>b.classList.remove('active'));
    panels.forEach(p=>p.classList.remove('active'));
    btn.classList.add('active');
    const panel=document.getElementById(btn.dataset.tab);
    panel.classList.add('active');
  });
});

// Notifications
function banner(msg){
  const d=document.createElement('div');
  d.className='banner';
  d.innerText=msg;
  document.body.appendChild(d);
  setTimeout(()=>d.remove(),5000);
}
try{
  const es=new EventSource('/events');
  es.onmessage=(e)=>banner(e.data);
}catch(e){console.warn('SSE not supported.');}

// Analytics
async function loadAnalytics(){
  try{
    const r=await fetch('/admin/analytics-data');
    const data=await r.json();
    const ctx=document.getElementById('chart').getContext('2d');
    const labels=data.daily.map(d=>d[0]);
    const values=data.daily.map(d=>d[1]);
    new Chart(ctx,{
      type:'line',
      data:{labels:labels,datasets:[{
        label:'Queries per Day',
        data:values,
        borderColor:'#22d3ee',
        tension:.25,
        fill:false
      }]},
      options:{plugins:{legend:{labels:{color:'#e2e8f0'}}},
      scales:{x:{ticks:{color:'#94a3b8'}},y:{ticks:{color:'#94a3b8'}}}}
    });
    const tbody=document.querySelector('#userTable tbody');
    tbody.innerHTML=data.users.map(u=>`<tr><td>${u[0]}</td><td>${u[1]}</td></tr>`).join('');
  }catch(e){console.error(e);}
}
loadAnalytics();
</script>
</body>
</html>
